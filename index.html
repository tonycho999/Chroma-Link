<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Chroma Link - Full Logic Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --cell-size: 60px; }
        .grid-container { 
            display: grid; 
            grid-template-columns: 50px repeat(5, var(--cell-size)) 50px; 
            grid-template-rows: 50px repeat(5, var(--cell-size)) 50px;
            gap: 2px; background: #111; padding: 10px; border-radius: 15px;
        }
        .cell { width: var(--cell-size); height: var(--cell-size); background: #222; position: relative; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #333; }
        .outer { display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px; color: #555; }
        .mirror-1 { width: 80%; height: 4px; background: #ddd; transform: rotate(-45deg); box-shadow: 0 0 10px white; }
        .mirror-2 { width: 80%; height: 4px; background: #ddd; transform: rotate(45deg); box-shadow: 0 0 10px white; }
        .beam { position: absolute; pointer-events: none; z-index: 5; opacity: 0.8; }
        .active-goal { border: 3px solid white; box-shadow: 0 0 15px white; }
    </style>
</head>
<body class="bg-zinc-950 text-white min-h-screen flex flex-col items-center py-8">

    <div class="text-center mb-6">
        <h1 class="text-3xl font-black text-indigo-400 tracking-tighter">CHROMA LINK ENGINE</h1>
        <p class="text-zinc-500 italic text-sm">ÎπõÏùÑ Íµ¥Ï†àÏãúÏºú Ïò§Î•∏Ï™Ω Î™©ÌëúÎ•º Ï±ÑÏö∞ÏÑ∏Ïöî!</p>
    </div>

    <div id="board" class="grid-container border border-zinc-800 shadow-2xl"></div>

    <div class="mt-8 flex flex-wrap justify-center gap-3">
        <button onclick="setTool('R')" class="px-4 py-2 bg-red-600 rounded-md font-bold hover:scale-105 transition">Red</button>
        <button onclick="setTool('G')" class="px-4 py-2 bg-green-600 rounded-md font-bold hover:scale-105 transition">Green</button>
        <button onclick="setTool('B')" class="px-4 py-2 bg-blue-600 rounded-md font-bold hover:scale-105 transition">Blue</button>
        <button onclick="setTool('M1')" class="px-4 py-2 bg-zinc-600 rounded-md font-bold hover:scale-105 transition">Í±∞Ïö∏(/)</button>
        <button onclick="setTool('M2')" class="px-4 py-2 bg-zinc-600 rounded-md font-bold hover:scale-105 transition">Í±∞Ïö∏(\)</button>
        <button onclick="showAnswer()" class="px-4 py-2 bg-yellow-600 text-black rounded-md font-black hover:bg-yellow-400 transition">üí° Ï†ïÎãµ Î≥¥Í∏∞</button>
        <button onclick="resetGame()" class="px-4 py-2 border border-zinc-600 rounded-md hover:bg-zinc-800">Ï¥àÍ∏∞Ìôî</button>
    </div>

    <script>
        const SIZE = 5;
        let tool = 'R';
        let grid = Array.from({length: SIZE}, () => Array(SIZE).fill(null));
        // Î™©Ìëú: Ïò§Î•∏Ï™Ω 3Î≤àÏß∏ Ïπ∏Ïóê 'Î≥¥ÎùºÏÉâ(Magenta)' ÎßåÎì§Í∏∞
        const goals = { right: [null, null, {r:255, g:0, b:255, name:'Magenta'}, null, null] };

        function setTool(t) { tool = t; }

        function init() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            for(let r=-1; r<=SIZE; r++) {
                for(let c=-1; c<=SIZE; c++) {
                    const cell = document.createElement('div');
                    if(r >= 0 && r < SIZE && c >= 0 && c < SIZE) {
                        cell.className = 'cell';
                        cell.id = `c-${r}-${c}`;
                        cell.onclick = () => { grid[r][c] = (grid[r][c] === tool) ? null : tool; render(); };
                    } else {
                        cell.className = 'outer';
                        if(c === SIZE && r >= 0 && r < SIZE && goals.right[r]) {
                            cell.id = `goal-r-${r}`;
                            cell.style.backgroundColor = 'rgba(255,0,255,0.2)';
                            cell.innerText = 'GOAL';
                        }
                    }
                    board.appendChild(cell);
                }
            }
            render();
        }

        function render() {
            // UI Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.cell').forEach(c => {
                c.innerHTML = '';
                const [_, r, col] = c.id.split('-').map(Number);
                const obj = grid[r][col];
                if(obj === 'R') c.innerHTML = '<div class="w-6 h-6 rounded-full bg-red-500 shadow-[0_0_10px_red]"></div>';
                if(obj === 'G') c.innerHTML = '<div class="w-6 h-6 rounded-full bg-green-500 shadow-[0_0_10px_green]"></div>';
                if(obj === 'B') c.innerHTML = '<div class="w-6 h-6 rounded-full bg-blue-500 shadow-[0_0_10px_blue]"></div>';
                if(obj === 'M1') c.innerHTML = '<div class="mirror-1"></div>';
                if(obj === 'M2') c.innerHTML = '<div class="mirror-2"></div>';
            });
            calculateBeams();
        }

        function calculateBeams() {
            let hits = Array.from({length: SIZE}, () => ({r:0, g:0, b:0}));

            for(let r=0; r<SIZE; r++) {
                for(let c=0; c<SIZE; c++) {
                    const item = grid[r][c];
                    if(['R','G','B'].includes(item)) {
                        // Í¥ëÏõê Î∞úÍ≤¨ Ïãú 4Î∞©Ìñ• Ï°∞ÏÇ¨ (Ïù¥ ÏÉòÌîåÏóêÏÑ† Ïò§Î•∏Ï™ΩÎßå Ìà¨ÏÇ¨ ÏòàÏãú)
                        traceRay(r, c, 0, 1, item, hits); 
                    }
                }
            }

            // ÏäπÎ¶¨ Ï≤¥ÌÅ¨
            goals.right.forEach((g, idx) => {
                if(!g) return;
                const hit = hits[idx];
                const goalEl = document.getElementById(`goal-r-${idx}`);
                if(hit.r === g.r && hit.b === g.b) {
                    goalEl.style.backgroundColor = `rgb(${g.r},${g.g},${g.b})`;
                    goalEl.classList.add('active-goal');
                } else {
                    goalEl.style.backgroundColor = 'rgba(255,0,255,0.2)';
                    goalEl.classList.remove('active-goal');
                }
            });
        }

        function traceRay(r, c, dr, dc, color, hits) {
            let currR = r, currC = c;
            while(true) {
                currR += dr; currC += dc;
                if(currR < 0 || currR >= SIZE || currC < 0 || currC >= SIZE) {
                    if(currC === SIZE && currR >= 0 && currR < SIZE) {
                        if(color === 'R') hits[currR].r = 255;
                        if(color === 'B') hits[currR].b = 255;
                    }
                    break;
                }
                // Í±∞Ïö∏ Î°úÏßÅ
                if(grid[currR][currC] === 'M1') { [dr, dc] = [-dc, -dr]; }
                if(grid[currR][currC] === 'M2') { [dr, dc] = [dc, dr]; }
            }
        }

        function showAnswer() {
            resetGame();
            grid[2][0] = 'R'; // 2Ìñâ 0Ïó¥Ïóê Îπ®Í∞ï
            grid[2][2] = 'B'; // 2Ìñâ 2Ïó¥Ïóê ÌååÎûë (ÏßÅÏÑ†ÏúºÎ°ú ÎèÑÎã¨)
            render();
            alert("Ï†ïÎãµ: Îπ®Í∞ïÍ≥º ÌååÎûë Í¥ëÏõêÏùÑ 3Î≤àÏß∏ Ìñâ(Row)Ïóê ÎÇòÎûÄÌûà ÎëêÎ©¥ Î≥¥ÎùºÏÉâÏù¥ ÏôÑÏÑ±Îê©ÎãàÎã§!");
        }

        function resetGame() {
            grid = Array.from({length: SIZE}, () => Array(SIZE).fill(null));
            render();
        }

        init();
    </script>
</body>
</html>
