<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Chroma Link - Level System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --cell-size: 60px; }
        .grid-container { 
            display: grid; 
            grid-template-columns: 50px repeat(5, var(--cell-size)) 50px; 
            grid-template-rows: 50px repeat(5, var(--cell-size)) 50px;
            gap: 2px; background: #111; padding: 10px; border-radius: 15px; position: relative;
        }
        .cell { width: var(--cell-size); height: var(--cell-size); background: #222; position: relative; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #333; z-index: 10; }
        .outer { display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px; z-index: 5; }
        .mirror-1 { width: 80%; height: 4px; background: #eee; transform: rotate(-45deg); box-shadow: 0 0 10px white; }
        .mirror-2 { width: 80%; height: 4px; background: #eee; transform: rotate(45deg); box-shadow: 0 0 10px white; }
        /* ë¹›ì˜ ê¶¤ì  ìŠ¤íƒ€ì¼ */
        .beam-path { position: absolute; pointer-events: none; z-index: 2; mix-blend-mode: screen; transition: all 0.2s; }
        .active-goal { border: 3px solid white; box-shadow: 0 0 20px white; transform: scale(1.1); }
    </style>
</head>
<body class="bg-zinc-950 text-white min-h-screen flex flex-col items-center py-8">

    <div class="text-center mb-4">
        <h1 id="level-title" class="text-3xl font-black text-indigo-400">LEVEL 1: ì‹œì‘</h1>
        <p id="level-desc" class="text-zinc-500 text-sm">ê¸°ì´ˆ í˜¼í•©: ë³´ë¼ìƒ‰ì„ ë§Œë“œì„¸ìš”.</p>
    </div>

    <div id="board" class="grid-container border border-zinc-800 shadow-2xl"></div>

    <div id="beam-layer" class="absolute inset-0 pointer-events-none"></div>

    <div class="mt-8 flex flex-wrap justify-center gap-3">
        <button onclick="setTool('R')" class="px-4 py-2 bg-red-600 rounded-md font-bold">Red</button>
        <button onclick="setTool('G')" class="px-4 py-2 bg-green-600 rounded-md font-bold">Green</button>
        <button onclick="setTool('B')" class="px-4 py-2 bg-blue-600 rounded-md font-bold">Blue</button>
        <button onclick="setTool('M1')" class="px-4 py-2 bg-zinc-600 rounded-md font-bold">ê±°ìš¸(/)</button>
        <button onclick="setTool('M2')" class="px-4 py-2 bg-zinc-600 rounded-md font-bold">ê±°ìš¸(\)</button>
    </div>

    <div class="mt-6 flex gap-4">
        <button onclick="showAnswer()" class="text-yellow-500 font-bold underline">ğŸ’¡ ì •ë‹µ ë³´ê¸°</button>
        <button onclick="nextLevel()" class="px-6 py-2 bg-indigo-600 rounded-full font-black hover:bg-indigo-500">ë‹¤ìŒ ë ˆë²¨ â–¶</button>
    </div>

    <script>
        const SIZE = 5;
        let tool = 'R', currentLevel = 0, grid = [];
        
        const levels = [
            { title: "LEVEL 1: ê¸°ì´ˆ", desc: "ë³´ë¼ìƒ‰(R+B)ì„ íƒ€ê²Ÿì— ë§ì¶”ì„¸ìš”.", target: {r:2, c:SIZE, color:'magenta', rgb:[255,0,255]} },
            { title: "LEVEL 2: êµ´ì ˆ", desc: "ê±°ìš¸ì„ ì‚¬ìš©í•´ ë¹›ì„ êº¾ì–´ ë…¸ë€ìƒ‰(R+G)ì„ ë§Œë“œì„¸ìš”.", target: {r:4, c:SIZE, color:'yellow', rgb:[255,255,0]} },
            { title: "LEVEL 3: í™”ì´íŠ¸ ì•„ì›ƒ", desc: "ëª¨ë“  ë¹›ì„ í•œê³³ìœ¼ë¡œ ëª¨ì•„ í°ìƒ‰ì„ ë§Œë“œì„¸ìš”.", target: {r:0, c:SIZE, color:'white', rgb:[255,255,255]} }
        ];

        function init() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            const lv = levels[currentLevel];
            document.getElementById('level-title').innerText = lv.title;
            document.getElementById('level-desc').innerText = lv.desc;
            grid = Array.from({length: SIZE}, () => Array(SIZE).fill(null));

            for(let r=-1; r<=SIZE; r++) {
                for(let c=-1; c<=SIZE; c++) {
                    const cell = document.createElement('div');
                    if(r >= 0 && r < SIZE && c >= 0 && c < SIZE) {
                        cell.className = 'cell';
                        cell.id = `c-${r}-${c}`;
                        cell.onclick = () => { grid[r][c] = (grid[r][c] === tool) ? null : tool; render(); };
                    } else if (r === lv.target.r && c === lv.target.c) {
                        cell.className = 'outer border-2 border-dashed border-zinc-700';
                        cell.id = 'goal-target';
                        cell.innerText = 'GOAL';
                    } else { cell.className = 'outer'; }
                    board.appendChild(cell);
                }
            }
            render();
        }

        function render() {
            document.querySelectorAll('.cell').forEach(c => {
                const [_, r, col] = c.id.split('-').map(Number);
                const obj = grid[r][col];
                c.innerHTML = obj ? `<div class="${obj.startsWith('M') ? (obj==='M1'?'mirror-1':'mirror-2') : 'w-6 h-6 rounded-full shadow-lg'}" style="background-color: ${obj==='R'?'red':obj==='G'?'green':obj==='B'?'blue':''}"></div>` : '';
            });
            calculateLogic();
        }

        function calculateLogic() {
            const lv = levels[currentLevel];
            let hitColor = {r:0, g:0, b:0};
            // ë¹› ê·¸ë¦¬ê¸° ë¡œì§ (ë‹¨ìˆœí™”ëœ ì‹œë®¬ë ˆì´ì…˜)
            for(let r=0; r<SIZE; r++) {
                for(let c=0; c<SIZE; c++) {
                    if(['R','G','B'].includes(grid[r][c])) {
                        let cr = r, cc = c, dr = 0, dc = 1; // ê¸°ë³¸ ì˜¤ë¥¸ìª½ ë°œì‚¬
                        let color = grid[r][c];
                        while(cc <= SIZE) {
                            if(cc === lv.target.c && cr === lv.target.r) {
                                if(color === 'R') hitColor.r = 255;
                                if(color === 'G') hitColor.g = 255;
                                if(color === 'B') hitColor.b = 255;
                            }
                            if(cc < SIZE && grid[cr][cc] === 'M1') { [dr, dc] = [-dc, -dr]; }
                            if(cc < SIZE && grid[cr][cc] === 'M2') { [dr, dc] = [dc, dr]; }
                            cc += dc; cr += dr;
                            if(cr < 0 || cr >= SIZE) break;
                        }
                    }
                }
            }
            const goal = document.getElementById('goal-target');
            if(hitColor.r === lv.target.rgb[0] && hitColor.g === lv.target.rgb[1] && hitColor.b === lv.target.rgb[2]) {
                goal.style.backgroundColor = lv.target.color;
                goal.classList.add('active-goal');
            } else {
                goal.style.backgroundColor = 'transparent';
                goal.classList.remove('active-goal');
            }
        }

        function showAnswer() {
            if(currentLevel === 0) alert("ì •ë‹µ: ê°™ì€ í–‰(Row)ì— ë¹¨ê°•ê³¼ íŒŒë‘ ê´‘ì›ì„ ë‘ì„¸ìš”.");
            if(currentLevel === 1) alert("ì •ë‹µ: ê´‘ì›ì„ ë‹¤ë¥¸ ì¤„ì— ë‘ê³  ê±°ìš¸(\\)ì„ ì‚¬ìš©í•´ ëª©í‘œ ì¤„ë¡œ êº¾ìœ¼ì„¸ìš”.");
        }

        function nextLevel() {
            currentLevel = (currentLevel + 1) % levels.length;
            init();
        }

        function setTool(t) { tool = t; }
        init();
    </script>
</body>
</html>
